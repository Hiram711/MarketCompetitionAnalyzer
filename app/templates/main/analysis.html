{% extends "base/layout.html" %}
{% block styles %}
{{super()}}
<link href="https://cdn.bootcss.com/octicons/4.4.0/font/octicons.css" rel="stylesheet">
<link rel="stylesheet" href="{{url_for('static', filename='css/jqgrid/ui.jqgrid-bootstrap4.css')}}">
<link rel="stylesheet" href="{{url_for('static', filename='css/datetimepicker/bootstrap-datetimepicker.min.css')}}">
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
{% endblock %}

{% block content %}
<style>
.mark {
    padding: 0px;
    background: white;
}
.form-control{
    display:inline;
}
.btn btn-light{
    font-size: 5px;
}
</style>
<h4>数据分析</h4>
<HR>
<form>

<div class="row offset-md-1">
    <div class = "col-sm-3" id="content">

            <label class = "mark col-sm-3">对比内容:</label>
            <label class="col-sm-4 radio-inline" style="padding-left: 10px"><input type="radio" name="optradio"
                                                                          value="economic">经济舱</label>
            <label class="col-sm-4 radio-inline" style="padding-left: 10px"><input type="radio"  name="optradio"
                                                                          value="firstclass">头等舱</label>

    </div>
    <div class = " col-sm-3">
    <label class = " mark col-sm-3">航班日期:</label>
    <input class = "form-control col-sm-6" name="flightDate"  placeholder="请选择航班日期" id="blrz-entry-date-start" type="text" >
    </div>

    <div class = " col-sm-4">
        <label class = "mark col-sm-1" >航段:</label>
        <select class="form-control col-sm-4" placeholder  = "请选择航段" id="segment">
        </select>

    </div>

     <button type="button" class="btn btn-success" onclick = "generatebtn()">筛选</button>
</div>
</form>

<HR>
<div class="row">
<button type="button" class="btn btn-light" onclick="lastWeek()"><i class ="fa fa-angle-left"> 前一周</i></button>

<div class="btn-group" id = "flight-date">

  </div>

<button type="button" class="btn btn-light" onclick="nextWeek()">后一周 <i class ="fa fa-angle-right"></i></button>
</div>


{% endblock %}


{% block scripts %}
{{super()}}
<script src="{{url_for('static', filename='js/jquery-ui/jquery-ui.min.js')}}"></script>
<script src="{{url_for('static', filename='js/jqgird/grid.locale-cn.js')}}"></script>
<script src="{{url_for('static', filename='js/jqgird/jquery.jqGrid.min.js')}}"></script>
<script src="{{url_for('static', filename='js/datetimepicker/bootstrap-datetimepicker.min.js')}}"></script>
<script src="{{url_for('static', filename='js/datetimepicker/bootstrap-datetimepicker.zh-CN.js')}}"></script>
<script>
 $(document).ready(function () {
     $("#blrz-entry-date-start").datetimepicker({//选择年月日
         format: 'yyyy-mm-dd',
         language: 'zh-CN',
         weekStart: 1,
         todayBtn: 1,//显示‘今日’按钮
         autoclose: 1,
         startView: 2,
         minView: 2,  //Number, String. 默认值：0, 'hour'，日期时间选择器所能够提供的最精确的时间选择视图。

         forceParse: 0
     });

       $.ajax({
                url: "{{url_for('main.analysis_segments')}}",
                data: {

                },
                dataType: "json",
                type: "GET",
                success: function (res) {
                    if (res != null && res != "") { // 注册成功
                        var segmenthtml = "";
                      for (var i = 0;i<res.length;i++){
                          segmenthtml += "<option value='" + res[i].id + "'>"+res[i].dep_city+"-"+res[i].arv_city+"</option>";

                      }
                      $("#segment").append(segmenthtml);
                    }
                },
                fail: function (err) {
                    alert("error！");
                }

            });

 });

 function  generatebtn(){
     var flightdateStr = $("#blrz-entry-date-start").val();
     var flightdate = new Date(flightdateStr);
     $("#flight-date").empty();
     flightdate.setDate(flightdate.getDate() - 4);
     if(flightdate!=null){
         var html = "";
         for(var i= 0;i<7;i++){
           var  newflightdate =  flightdate;
           newflightdate.setDate(flightdate.getDate() + 1);
           var newflightdateStr = transform(newflightdate);
           html +=
             "    <button type=\"button\" id= '"+i+"-btn"+"'   class=\"btn btn-primary\">"+newflightdateStr+"</button>\n" ;
         }
         $("#flight-date").append(html);


     }
 }

 function  lastWeek(){
     var buttonValue= document.getElementById('3-btn').innerHTML;
     var flightdate = new Date(buttonValue);
     $("#flight-date").empty();
     flightdate.setDate(flightdate.getDate() - 7);
      var html = "";
         for(var i= 0;i<7;i++){
           var  newflightdate =  flightdate;
           newflightdate.setDate(flightdate.getDate() + 1);
           var newflightdateStr = transform(newflightdate);
           html +=
            "    <button type=\"button\" id= '"+i+"-btn"+"'   class=\"btn btn-primary\">"+newflightdateStr+"</button>\n" ;
         }
         $("#flight-date").append(html);

 }

 function  nextWeek(){
     var buttonValue= document.getElementById('3-btn').innerHTML;
     var flightdate = new Date(buttonValue);
     $("#flight-date").empty();
     flightdate.setDate(flightdate.getDate() - 1);
      var html = "";
         for(var i= 0;i<7;i++){
           var  newflightdate =  flightdate;
           newflightdate.setDate(flightdate.getDate() + 1);
           var newflightdateStr = transform(newflightdate);
           html +=
            "    <button type=\"button\" id= '"+i+"-btn"+"'   class=\"btn btn-primary\">"+newflightdateStr+"</button>\n" ;
         }
         $("#flight-date").append(html);

 }

 function transform(date){
     var str = date.getFullYear() + '-'
    + (parseInt(date.getMonth()) + 1) + '-'
    + date.getDate();

     return str;
 }


</script>
{% endblock %}